{"root":{"data":{"text":"chart部署健康诊断"},"children":[{"data":{"text":"初始化诊断管理器"},"children":[{"data":{"text":"创建Manager实例"},"children":[{"data":{"text":"注册默认诊断器"},"children":[{"data":{"text":"EventDiagnoser - 事件诊断器"},"children":[]},{"data":{"text":"PodDiagnoser - Pod诊断器"},"children":[]},{"data":{"text":"ServiceDiagnoser - 服务诊断器"},"children":[]},{"data":{"text":"ResourcesDiagnoser - 资源诊断器"},"children":[]}]},{"data":{"text":"配置诊断选项"},"children":[{"data":{"text":"WithNamespace - 设置命名空间"},"children":[]},{"data":{"text":"WithExistingResources - 使用现有资源"},"children":[]},{"data":{"text":"WithoutDefaultDiagnosers - 禁用默认诊断器"},"children":[]},{"data":{"text":"WithSpecificDiagnosers - 指定特定诊断器"},"children":[]}]}]}]},{"data":{"text":"收集资源"},"children":[{"data":{"text":"判断资源获取方式"},"children":[{"data":{"text":"从Helm获取资源"},"children":[{"data":{"text":"根据namespace, componentName获取helm release"},"children":[{"data":{"text":"获取release中的kubernetes资源列表"},"children":[]}]}]},{"data":{"text":"使用现有资源列表"},"children":[{"data":{"text":"直接使用传入的资源"},"children":[]}]}]},{"data":{"text":"资源分类"},"children":[{"data":{"text":"按资源类型分类"},"children":[{"data":{"text":"workload资源 (副本控制器)"},"children":[{"data":{"text":"Deployment"},"children":[]},{"data":{"text":"StatefulSet"},"children":[]},{"data":{"text":"DaemonSet"},"children":[]},{"data":{"text":"Job"},"children":[]},{"data":{"text":"CronJob"},"children":[]}]},{"data":{"text":"service资源"},"children":[{"data":{"text":"Service"},"children":[]},{"data":{"text":"Ingress"},"children":[]}]},{"data":{"text":"其他资源"},"children":[{"data":{"text":"ConfigMap"},"children":[]},{"data":{"text":"Secret"},"children":[]},{"data":{"text":"PersistentVolumeClaim"},"children":[]}]}]}]},{"data":{"text":"提取Pod信息"},"children":[{"data":{"text":"从workload资源中提取pod"},"children":[{"data":{"text":"关联pod到对应的控制器"},"children":[{"data":{"text":"通过标签选择器匹配"},"children":[]},{"data":{"text":"建立ControllerInfo映射关系"},"children":[]}]}]},{"data":{"text":"收集异常pod日志"},"children":[{"data":{"text":"判断pod是否异常"},"children":[{"data":{"text":"检查pod phase"},"children":[{"data":{"text":"Pending - 等待调度"},"children":[]},{"data":{"text":"Failed - 执行失败"},"children":[]}]},{"data":{"text":"检查容器状态"},"children":[{"data":{"text":"CrashLoopBackOff"},"children":[]},{"data":{"text":"ImagePullBackOff"},"children":[]},{"data":{"text":"Error状态"},"children":[]}]}]},{"data":{"text":"收集pod日志"},"children":[{"data":{"text":"当前容器日志 - 最后100行"},"children":[]},{"data":{"text":"上一个容器日志 - 最后100行"},"children":[]}]}]}]},{"data":{"text":"收集k8s事件"},"children":[{"data":{"text":"获取namespace下的所有事件"},"children":[{"data":{"text":"按时间排序"},"children":[]},{"data":{"text":"过滤相关事件"},"children":[]}]}]}]},{"data":{"text":"诊断器初始化"},"children":[{"data":{"text":"遍历所有注册的诊断器"},"children":[{"data":{"text":"检查诊断器所需资源类型"},"children":[{"data":{"text":"RequiredResources()方法"},"children":[]}]},{"data":{"text":"为诊断器准备资源"},"children":[{"data":{"text":"过滤匹配的资源类型"},"children":[{"data":{"text":"workload类型资源"},"children":[]},{"data":{"text":"service类型资源"},"children":[]},{"data":{"text":"event类型资源"},"children":[]}]},{"data":{"text":"判断是否需要提供事件"},"children":[{"data":{"text":"shouldProvideEvents()检查"},"children":[]}]}]}]}]},{"data":{"text":"并行执行诊断"},"children":[{"data":{"text":"启动goroutine执行每个诊断器"},"children":[{"data":{"text":"事件诊断 (EventDiagnoser)"},"children":[{"data":{"text":"遍历所有事件"},"children":[{"data":{"text":"判断事件类型"},"children":[{"data":{"text":"Normal事件 - 正常"},"children":[]},{"data":{"text":"Warning事件 - 警告"},"children":[]}]},{"data":{"text":"分析事件Reason"},"children":[{"data":{"text":"FailedScheduling"},"children":[{"data":{"text":"Insufficient cpu - cpu不足"},"children":[]},{"data":{"text":"Insufficient memory - memory不足"},"children":[]},{"data":{"text":"node(s) had taints - 节点污点"},"children":[]},{"data":{"text":"didn't match node selector - 节点选择器不匹配"},"children":[]}]},{"data":{"text":"ErrImagePull"},"children":[{"data":{"text":"pulling image失败"},"children":[]},{"data":{"text":"镜像不存在或权限问题"},"children":[]}]},{"data":{"text":"CrashLoopBackOff"},"children":[{"data":{"text":"容器启动后崩溃"},"children":[]},{"data":{"text":"配置错误或代码问题"},"children":[]}]},{"data":{"text":"BackOff"},"children":[{"data":{"text":"退避重试"},"children":[]}]},{"data":{"text":"Pulling"},"children":[{"data":{"text":"正在拉取镜像"},"children":[]}]},{"data":{"text":"... ..."},"children":[]}]}]},{"data":{"text":"生成事件诊断建议"},"children":[{"data":{"text":"GenerateEventRecommendations()"},"children":[]}]}]},{"data":{"text":"Pod诊断 (PodDiagnoser)"},"children":[{"data":{"text":"从workload中提取pod"},"children":[{"data":{"text":"extractPodsFromWorkloads()"},"children":[]}]},{"data":{"text":"遍历每个pod进行诊断"},"children":[{"data":{"text":"检查pod phase"},"children":[{"data":{"text":"Pending - 等待状态"},"children":[{"data":{"text":"调用diagnosePendingPodStatus()"},"children":[{"data":{"text":"检查调度状态"},"children":[{"data":{"text":"节点选择器问题"},"children":[]},{"data":{"text":"资源不足"},"children":[]},{"data":{"text":"污点容忍问题"},"children":[]}]},{"data":{"text":"检查初始化容器"},"children":[{"data":{"text":"容器状态Waiting"},"children":[{"data":{"text":"ImagePullBackOff"},"children":[{"data":{"text":"镜像拉取失败"},"children":[]}]},{"data":{"text":"CrashLoopBackOff"},"children":[{"data":{"text":"容器启动失败"},"children":[{"data":{"text":"过滤日志关键字"},"children":[{"data":{"text":"\"at least 416k\" - 栈内存不足"},"children":[]},{"data":{"text":"\"OOMKilled\" - 内存溢出"},"children":[]},{"data":{"text":"\"permission denied\" - 权限问题"},"children":[]}]}]}]},{"data":{"text":"CreateContainerConfigError"},"children":[{"data":{"text":"配置错误"},"children":[]}]}]},{"data":{"text":"容器状态Terminated"},"children":[{"data":{"text":"检查退出码"},"children":[]}]}]},{"data":{"text":"检查存储卷挂载"},"children":[{"data":{"text":"PersistentVolumeClaim问题"},"children":[]}]}]}]},{"data":{"text":"Running - 运行状态"},"children":[{"data":{"text":"调用diagnoseRunningPodStatus()"},"children":[{"data":{"text":"检查初始化容器状态"},"children":[{"data":{"text":"ready: true - 正常"},"children":[]},{"data":{"text":"ready: false - 异常"},"children":[{"data":{"text":"获取容器状态和日志"},"children":[]}]}]},{"data":{"text":"检查普通容器状态"},"children":[{"data":{"text":"ready: true - 正常"},"children":[]},{"data":{"text":"ready: false - 异常"},"children":[{"data":{"text":"容器状态分析"},"children":[{"data":{"text":"Waiting状态"},"children":[{"data":{"text":"CrashLoopBackOff"},"children":[{"data":{"text":"过滤日志关键字"},"children":[{"data":{"text":"\"panic:\" - 程序panic"},"children":[]},{"data":{"text":"\"fatal error:\" - 致命错误"},"children":[]}]}]},{"data":{"text":"ImagePullBackOff"},"children":[]}]},{"data":{"text":"Running状态但not ready"},"children":[{"data":{"text":"就绪探针失败"},"children":[]},{"data":{"text":"存活探针失败"},"children":[]}]},{"data":{"text":"Terminated状态"},"children":[{"data":{"text":"检查退出码和原因"},"children":[]}]}]}]}]}]}]},{"data":{"text":"Succeeded - 成功完成"},"children":[{"data":{"text":"一般是Job类型"},"children":[]},{"data":{"text":"检查是否正常完成"},"children":[]}]},{"data":{"text":"Failed - 执行失败"},"children":[{"data":{"text":"检查失败原因"},"children":[]},{"data":{"text":"分析容器退出码"},"children":[]}]},{"data":{"text":"Unknown - 状态未知"},"children":[{"data":{"text":"节点通信问题"},"children":[]},{"data":{"text":"kubelet异常"},"children":[]}]}]}]},{"data":{"text":"生成pod诊断总结和建议"},"children":[]}]},{"data":{"text":"服务诊断 (ServiceDiagnoser)"},"children":[{"data":{"text":"检查Service配置"},"children":[{"data":{"text":"端口映射检查"},"children":[]},{"data":{"text":"选择器匹配验证"},"children":[]},{"data":{"text":"ClusterIP分配"},"children":[]}]},{"data":{"text":"检查Ingress配置"},"children":[{"data":{"text":"路由规则验证"},"children":[]},{"data":{"text":"TLS配置检查"},"children":[]}]},{"data":{"text":"生成服务诊断建议"},"children":[]}]},{"data":{"text":"资源诊断 (ResourcesDiagnoser)"},"children":[{"data":{"text":"检查资源配额"},"children":[{"data":{"text":"CPU/Memory限制"},"children":[]},{"data":{"text":"存储配额"},"children":[]}]},{"data":{"text":"检查网络策略"},"children":[]},{"data":{"text":"检查RBAC权限"},"children":[]},{"data":{"text":"生成资源诊断建议"},"children":[]}]}]},{"data":{"text":"收集所有诊断结果"},"children":[{"data":{"text":"等待所有goroutine完成"},"children":[]},{"data":{"text":"汇总ResourceDiagnosis列表"},"children":[]}]}]},{"data":{"text":"结果聚合"},"children":[{"data":{"text":"调用AggregateDiagnoses()函数"},"children":[{"data":{"text":"分析workload状态"},"children":[{"data":{"text":"analyzeWorkloadStatus()"},"children":[{"data":{"text":"统计健康/警告/错误pod数量"},"children":[]},{"data":{"text":"确定整体workload状态"},"children":[]}]}]},{"data":{"text":"分析事件状态"},"children":[{"data":{"text":"analyzeEventStatus()"},"children":[{"data":{"text":"统计Normal/Warning事件"},"children":[]},{"data":{"text":"确定事件严重程度"},"children":[]}]}]},{"data":{"text":"确定整体诊断状态"},"children":[{"data":{"text":"determineOverallStatus()"},"children":[{"data":{"text":"综合workload、service、event状态"},"children":[]},{"data":{"text":"返回最终健康状态"},"children":[]}]}]},{"data":{"text":"生成状态消息"},"children":[{"data":{"text":"generateStatusMessage()"},"children":[{"data":{"text":"根据状态生成描述性消息"},"children":[]}]}]},{"data":{"text":"汇总摘要和建议"},"children":[{"data":{"text":"合并所有诊断器的摘要"},"children":[]},{"data":{"text":"去重并整理建议列表"},"children":[]}]}]},{"data":{"text":"生成最终诊断报告"},"children":[{"data":{"text":"构建Diagnosis结构"},"children":[{"data":{"text":"整体状态和消息"},"children":[]},{"data":{"text":"详细摘要列表"},"children":[]},{"data":{"text":"建议列表"},"children":[]},{"data":{"text":"workload状态"},"children":[]},{"data":{"text":"service状态"},"children":[]},{"data":{"text":"event状态"},"children":[]}]},{"data":{"text":"转换为Protobuf格式"},"children":[{"data":{"text":"ToProto()方法"},"children":[]}]}]},{"data":{"text":"返回诊断结果"},"children":[]}]}]},"template":"right","theme":"fresh-blue","version":"1.4.43"}